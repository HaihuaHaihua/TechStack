## 进程与线程

### 进程

**进程基本概念**

* 进程：操作系统对程序的加载并运行的动态概念

* 进程在内核中的组织形式：进程控制块PCB 

* 进程控制块的组织结构 

  * 物理组织结构：进程`pcb`调度队列 
  * 逻辑组织结构：进程创建过程中形成的前后逻辑树关系

* 进程状态以及状态切换

  > * `TASK_RUNNING`
  > * `TASK_INTERRUPTIBLE`
  > * `TASK_UNINTERTUPTIBLE`
  > * `TASK_SOTPPED`
  > * `TASK_ZOMBILE`

* 进程的文件管理：`task_struct`索引机制

* 进程的内存管理：`task_struct`索引机制

**进程基本属性**

* `ps -aux`： process status 查看系统正在运行的所有进程的详细属性

* 进程ID：获取进程ID`getpid(void)`

* 进程真实用户和真实用户组：获取进程真实用户ID `getuid(void)`，获取进程真实用户组ID`getgid(void)`

* 进程有效用户和有效用户组：获取进程有效用户ID `geteuid(void)`，获取进程有效用户组ID`getegid(void)` 

* 有效用户与真实用户实例`3.1.1.c`

  ```c
  #include <stdio.h>
  #include <stdlib.h>
  #incldue <unistd.h>
  #include <sys/types.h>
  int main(int argc, char const *argv[])
  {
      printf("real uid: %d,real gid: %d \n",getuid(),getgid());
      printf("effective uid: %d, effective gid: %d\n",geteuid(),getegid());
      exit(0);
  }
  /*
  ./3.1.1         //查看真实用户和有效用户的ID
  ls -l 3.1.1     //查看是否设置了用户ID
  chmod u+s 3.1.1 //添加文件特殊属性用户ID位
  su              //切换到root权限
  chown root 3.1.1//改变文件的所有者
  ./3.1.1         //查看有效用户ID是否发生变化 有效用户ID会变成其所有者的用户ID
  */
  ```

* 用户密码

  * `/etc/password`：存储所有用户信息
  * `etc/shadow`：存储用户密码
  * `password`：修改用户密码命令，其有效用户ID为root
  * LINUX根据进程的的有效用户进行权限检查

**进程生命周期**

* 进程的启动：进程代码的入口`main(int argc,char const *argv[])`，内核启动C程序是，在调用main函数之前调用特殊的启动函数获取main函数地址和传递给它的参数，并将这些信息写入`pcb`

* 进程的终止

  * 正常终止，从main函数返回；调用exit()或者_exit()终止；最后一个线程从其启动例程中返回；最后一个线程调用`pthread_exit()`终止
  * 异常终止，调用`abort()`终止

* 进程的生命周期

  > * 调用：C启动例程 >> main() >> 用户函数 返回：用户函数 >> main() >> C例程
  > * 调用exit() >> 终止处理函数 >> 标准I/O清理函数 >> 调用_exit()返回到kernel

* 终止进程的函数

  * `void exit(int status)`：执行完终止处理函数和标准I/O处理函数之后才会返回内核

  * `void _exit(int status)`：终止当前进程的生命周期，并立即返回内核

  * `exit`与`return`的区别：

    > 1. return是关键字，exit()是`API`
    > 2. 在main函数中两者产生相同的效果
    > 3. return退出的是函数，从子函数中返回；而exit()则会终止进程

  * 终止处理函数：日志登记、资源释放等善后工作，通过`atexit()/on_exit()`注册若干个终止处理函数