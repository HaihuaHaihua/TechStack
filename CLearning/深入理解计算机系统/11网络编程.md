## 网络编程

### 11.1 C/S编程模型

**网络应用基本编程模型**

* 客户端-服务器是所有网络应用的基础编程模型，服务器管理资源，并且通过操作资源为客户端提供服务。
* 客户端和服务器是进程，而非硬件设备，一台硬件设备可以运行多个客户端或服务器。

**客户端-服务器基本事务**

1. 客户端发送请求：发起一个事务
2. 服务器处理请求：接收请求并处理，操作相应的资源
3. 服务器发送响应：发送响应并等待下一个请求
4. 客户端处理响应：接收响应并处理

----

### 11.2 网络

**对于主机而言的网络**

* 一种I/O外设，是数据源和数据接收方
* 以网络适配器作为物理接口，通过DMA方式传送实现内存与网络的数据交换

**以太网局域网**

* 主机物理地址：以太网适配器上的全球唯一48位地址
* 数据传输：数据帧，包含源地址和目的地址的**头部**和数据
* 网络连接：集线器和网桥，网桥具有自学习分配算法可以更好的利用电缆带宽

**因特网广域网**

* 主机逻辑地址：IP地址
* 数据传输：IP数据报
* 网络连接：路由器，一种特殊的计算机链接各种局域网和广域网

**网络协议**

* 网络协议是通过运行在主机上的**协议软件**实现的

* 网络协议的基本能力：

  > 1. **命名机制**：统一网络中的主机地址格式，可以唯一的标识网络中的主机
  > 2. **传送机制**：数据的封装格式相同，消除了不同联网技术的差异

----

### 11.3 因特网

**IP地址**

* 因特网中的主机集合被映射一组32位的IP地址
* IP地址通常使用**点分十进制表示法**来表示，可以使用`hostname -i`查看本机IP地址

**DNS域名系统**

* 域名是到IP地址的映射
* DNS数据库中有上万条主机条目结构，它定义了一组域名和一组IP地址之间的映射，可以使用`nslookup 域名`查询域名对应的IP地址

**因特网连接**

* 端口：主机中一个需要通信的进程要用一个套接字来唯一标识，套接字的套接字地址由一个IP地址和一个16位的整数端口组成
* 套接字对：用来表示一个连接，由连接两端的套接字地址唯一确定的四元组

----

### 11.4 套接字接口

* 套接字接口是一组函数，有操作系统的内核实现

**基本套接字接口函数**

* `socket()`：创建一个套接字描述符
* `connetc()`：客户端用来建立与服务器的连接
* 服务器用来建立与客户端的连接
  * `bind()`：服务器用建立服务器套接字地址和套接字描述符的联系
  * `listen()`：监听来自客户端的连接请求
  * `accept()`：等待来自客户端的连接请求

**？？主机和服务的转换？？**

* `getaddrinfo()`:
* `getnameinfo()`:

**套接字接口高级辅助函数**

* `open_clientfd()`：客户端与服务器建立连接，返回一个套接字描述符
* `open_listenfd()`：服务器创建一个监听描述符，准备接收连接请求

----

### 11.5 Web服务器

Web**服务器基本特点**

* Web服务器与客户端的交互基于文本的HTTP协议
* Web内容主要有HTML程序构成，HTML的超链接`href`是主要特点可以指向因特网内的任意一台主机上的内容

Web**内容**

* Web内容是一个MIME类型相关的字节序列，包括HTML/GIF/PNG等等类型
* Web服务器主要以两种方式向客户端提供内容
  * 静态内容服务：取一个磁盘文件，并将其返回给客户端
  * 动态内容服务：运行一个可执行文件，并将它的输出返回给客户端，例如一个计算结果

HTTP**事务**

* HTTP事务有HTTP请求和HTTP响应构成
* HTTP请求 = 请求行 + 请求报头 + 空行结束
  * 请求行： `method URI version`三部分组成，请求方法包括GET/POST/HEAD等方法，HTTP版本这主要有HTTP/1.1等
  * 请求报头：`header-name:header-data`两部分组成
* HTTP响应 = 响应行 + 响应报头 + 空行结束 + 响应主体
  * 响应行：`version status-code status-message`，即为HTTP版本+状态码+状态消息
  * 响应报头：提供关于响应的附加信息
  * 响应主体：被请求的内容

















